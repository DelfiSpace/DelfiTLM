{% extends "admin/base.html" %}
{% block title %}DelfiSpace - Home{% endblock %}
{% load i18n static %}
{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% static "admin/css/login.css" %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
rel="stylesheet"
integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0"
crossorigin="anonymous">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>

<script src=" https://unpkg.com/@joergdietrich/leaflet.terminator@1.0.0/L.Terminator.js"></script>

{{ form.media }}
{% endblock %}


{% block nav-sidebar %}
{% endblock %}

{% block usertools %}
  {% if perms.transmission.view_downlink %}
  <a href="{% url 'get_frames_table' link='downlink'%}" >{% translate 'Downlink Transmission' %}</a>
  {% endif %}

  {% if perms.transmission.view_uplink %}
      <a href="{% url 'get_frames_table' link='uplink' %}" >{% translate 'Uplink Transmission' %}</a>
  {% endif %}

  {% if perms.transmission.view_uplink and perms.transmission.view_downlink %}
      <a href="{% url 'submit_job' %}" >{% translate 'Processing' %}</a>
  {% endif %}

    {% if user.is_authenticated %}
        <a href="{% url 'account' %}">{% translate 'Account' %}</a>
        {% else %}
        <a href="{% url 'login' %}">{% translate 'Login' %}</a>
    {% endif %}
{% endblock %}

{% block content %}
<div style="display: flex; flex-direction: row; flex-wrap: wrap;
justify-content: center;">

      <div class="card" style="width: 18rem; margin: 10px">
        <img src="https://d2k0ddhflgrk1i.cloudfront.net/_processed_/0/8/csm_Delfi-C3_0c2c5a8cde.webp" class="card-img-top"
        style = "max-width: 100%; max-height: 46.4%;" >
        <div class="card-body">

            <h5 class="card-title" style="color:Gray">Delfi-C3</h5>
            <p class="card-text"> Status: Operational </p>
            <a href="https://www.tudelft.nl/lr/delfi-space/delfi-c3"><input type="submit" value="About"></input></a>
            <a href="/grafana/d/_j9ikmi4z/delfipq"><input type="submit" value="Dashboard"></input></a>
        </div>
      </div>

      <div class="card" style="width: 18rem; margin: 10px">
        <img src="https://d2k0ddhflgrk1i.cloudfront.net/_processed_/2/e/csm_Delfi-n3Xt_f8c3d11d4d.webp" class="card-img-top"
        style = "max-width: 100%; max-height: 46.4%;" >
        <div class="card-body">

            <h5 class="card-title" style="color:Gray">Delfi-n3Xt</h5>
            <p class="card-text"> Status: Retired </p>
            <a href="https://www.tudelft.nl/lr/delfi-space/delfi-n3xt"><input type="submit" value="About"></input></a>
            <a href="/grafana/d/_j9ikmi4z/delfipq"><input type="submit" value="Dashboard" disabled=""></input></a>
        </div>
      </div>

      <div class="card" style="width: 18rem; margin: 10px">
        <img src="https://www.delta.tudelft.nl/sites/default/files/images/delfiPQ%20satelliet.jpg" class="card-img-top"
        style = "max-width: 100%; max-height: 46.4%;" >
        <div class="card-body">

            <h5 class="card-title" style="color:Gray">Delfi-PQ</h5>
            <p class="card-text">Status: Operational</p>
            <a href="https://www.tudelft.nl/lr/delfi-space/delfi-pq"><input type="submit" value="About"></input></a>
            <a href="/grafana/d/_j9ikmi4z/delfipq"><input type="submit" value="Dashboard"></input></a>
        </div>
      </div>

      <div class="card" style="width: 18rem; margin: 10px">

        <img src="https://d2a3ux41sjxpco.cloudfront.net/carousel/file/project_photo/29562/normal_8e31396ce80e9ac783c4900792933c114ff3bed5.png" class="card-img-top"
        style = "max-width: 100%; max-height: 46.4%;">

        <div class="card-body">

            <h5 class="card-title" style="color:Gray">Da Vinci Satellite</h5>
            <p class="card-text"> Status: Under development</p>
            <a href="https://davincisatellite.nl/?page_id=937&lang=en"><input type="submit" value="About"></input></a>
            <a href="/grafana/d/_j9ikmi4z/delfipq"><input type="submit" value="Dashboard" disabled=""></input></a>
        </div>
      </div>

    <div class="card" style="width: 18rem; margin: 10px">
        <img src="https://pbs.twimg.com/media/EY5TTgeWoAEittJ?format=jpg&name=large" class="card-img-top"
        style = "max-width: 100%; max-height: 46.4%;">

        <div class="card-body">

            <h5 class="card-title" style="color:Gray">More Info</h5>
<!--            <p class="card-text"> aaa </p>-->
            <br>
            <a href="https://twitter.com/DelfiSpace"><input type="submit" value="Twitter"></input></a>
            <a href="/grafana/d/sknvMScVz/latest-reception-times?orgId=1"><input type="submit" value="Latest Receptions"></input></a>

        </div>

      </div>

        <div class="card" style="width: 450; margin: 10px">
            <iframe src="http://localhost:3000/grafana/d-solo/sknvMScVz/latest-reception-times?orgId=1&panelId=2" width="450" height="200" frameborder="0"></iframe>
        </div>

        <div class="card" style="width: 450; margin: 10px">
            <iframe src="http://localhost:3000/grafana/d-solo/sknvMScVz/latest-reception-times?orgId=1&panelId=5" width="450" height="200" frameborder="0"></iframe>
        </div>

<div id="map" style="height: 700px; width: 70%"></div>

</div>

<script>

    let zoomLevel = 3;
    let latitude = 52.0116;
    let longitude = 4.3571;

    // refresh rate in seconds
    const refreshRate = 2;

    var map = L.map('map').setView([latitude, longitude], zoomLevel);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var t = L.terminator();
    t.addTo(map);
    setInterval(function(){updateTerminator(t)}, refreshRate * 1000);
    function updateTerminator(t) {
      t.setTime();
    }

    {% comment %} const marker = L.marker([latitude, longitude]).addTo(map).bindPopup("Delfi-PQ").openPopup(); {% endcomment %}
    let markers = {}

  function findSat(noradID) {
    fetch("/location/all/")
    .then(response => response.json())
    .then(data => {
      satellite_list = data.satellites;

      for (let i = 0; i<satellite_list.length; i++){
        console.log(satellite_list)
        sat = satellite_list[i].satellite
        lat = satellite_list[i].latitude.toFixed(2);
        long = satellite_list[i].longitude.toFixed(2);
        sunlit = satellite_list[i].sunlit;

        // call updateISS() function to update things
        updateSat(sat, lat, long, sunlit);

      }

    })
    .catch(e => console.log(e));
  }


function updateSat(sat, lat, long, sunlit) {

  if (markers.hasOwnProperty(sat)){
    markers[sat].setLatLng([lat, long]);
    markers[sat].bindPopup(sat + " Lat: " + lat + " Long: " + long);
  }
  else{
    var marker = L.marker([lat, long]).addTo(map).bindPopup(sat + " Lat: " + lat + " Long: " + long).openPopup();
    markers[sat] = marker
  }

  // updates map view according to Marker's new position
  // map.setView([lat, long]);
}

    setInterval(findSat, refreshRate * 1000);
</script>
{% endblock %}

